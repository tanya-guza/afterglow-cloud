{% extends "base.html" %}

{% block title %}
    Rendered Graph - Afterglow
{% endblock %}

{% block extra_head %}
    <script src="{{ STATIC_URL }}js/helios/lib/q.min.js"></script>
    <script src="{{ STATIC_URL }}js/helios/lib/uuid.js"></script>
    <script src="{{ STATIC_URL }}js/helios/lib/q-comm.js"></script>
    <script src="{{ STATIC_URL }}js/helios/helios.js"></script>
    <script src="{{ STATIC_URL }}js/d3.v3.js" ></script>
    <script src="{{ STATIC_URL }}js/jquery-svgpan.js" ></script>
    <script src="{{ STATIC_URL }}js/render.js" type="text/javascript"></script>
    <script src="{{ STATIC_URL }}js/metrics.js" type="text/javascript"></script>
{% endblock %}


{% block body %}

    <div class="row">

        <div class="span2">
            <h2>Controls</h2>

            <form id="controlForm">
                <fieldset>
                    <label>Comon</label>
                    <button class="btn btn-info btn-mini" id="zoomin">Zoom In</button>&nbsp;
                    <button class="btn btn-info btn-mini" id="zoomout">Zoom Out</button> <br><br>
                    <button class="btn btn-info btn-mini" id="reset">Reset</button> <br>
                    <label class="checkbox inline">
                        <input type="checkbox" id="panAndZoom" name="panAndZoom"  checked/>
                        Enable Pan-And-Zoom mode
                    </label>
                </fieldset>
                <hr>
                <fieldset>
                    <label>Node size settings</label>
                    <label class="checkbox inline">
                        <input type="checkbox" id="calculateBetweenness" name="calculateBetweenness" />
                        Calculate betweenness centrality
                    </label>
                    <br>
                    <label class="checkbox inline">
                        <input type="checkbox" id="considerNodeSize" name="considerNodeSize" checked/>
                        Consider size attribute
                    </label>
                </fieldset>
                <hr>
                <fieldset>
                    <label>Edge settings</label>
                    <label class="checkbox inline">
                        <input type="checkbox" id="considerEdgeWidth" name="considerEdgeWidth" checked/>
                        Consider edge width attribute
                    </label>
                </fieldset>
            </form>

        </div>

        <div class="span10">
        <h2 class="text-center">Rendered Graph</h2>

            {% if retVal %}

                <center>
                    <div class="cRenderError">
		<span class="cErrorMsg">

		{% ifequal retVal 1 %}
            Error: An invalid regular expression has been input which does not match one or more lines in the given file.
        {% endifequal %}

            {% ifequal retVal 2 %}
                Error: An invalid regular expression has been input which does not generate the required groupings for the file given to parse. If your expression has three groups, three columns will be attempted to be written.
            {% endifequal %}

            <br/><br/>
		Please try <a href="process" title="Back">again</a>.

		</span>
                    </div>
                </center>

            {% elif emptyData %}
                <center>
			<span id="error">
				Your search returned no data for AfterGlow to parse. Please try again.
			</span>
                    <a href="/search">Try Again</a>
                </center>
            {% else %}

                {% if not status %}

                    {% if form.errors %}
                        <div class="errorMsg">
                            Please correct the error{{ form.errors|pluralize }} below.
                        </div>
                    {% endif %}

                    <center>
                        <a href="#" id="galleryFormLink" alt="">Submit your image to the gallery!</a>
                    </center>

                    <br/><br/>

                    <form enctype="multipart/form-data" method="post" action="gallery-submit" id="gallerySubmitForm" class="hide">
                        {% csrf_token %}

                        <div class="field">
                            {{ form.name.errors }}
                            <label>Name:</label>
                            {{ form.name }}
                        </div>

                        <div class="field">
                            {{ form.description.errors }}
                            <label>Description:</label>
                            {{ form.description }}
                        </div>

                        <div class="field">
                            {{ form.author.errors }}
                            <label>Author:</label>
                            {{ form.author }}
                        </div>

                        <div class="field">
                            <label>&nbsp;</label>
                            <script type="text/javascript" src="http://api.recaptcha.net/challenge?k={{ CAPTCHA_PUBLIC_KEY }}"></script>
                        </div>

                        <noscript>
                            <iframe src="http://api.recaptcha.net/noscript?k={{ CAPTCHA_PUBLIC_KEY }}" height="300" width="500" frameborder="0"></iframe>
                            <br/>
                            <textarea name="recaptcha_challenge_field" rows="3" cols="40">
                            </textarea>
                            <input type="hidden" name="recaptcha_response_field" value="manual_challenge">
                        </noscript>

                        {% if captchaWrong %}
                            <div class="errorMsg">
                                Your captcha input is wrong. Please try again.
                            </div>
                        {% endif %}

                        {{ form.image }}


                        <input type="submit" value="Submit" id="xContactProcess">
                    </form>

                    <br/><br/>


                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="renderViewport"/>

                {% else %}

                    <center>
                        <div class="cRenderError"><span class="cErrorMsg">

			{% ifequal status 1 %}
                Error: Could not create an output image (1).
            {% endifequal %}

                            {% ifequal status 2 %}
                                Error: Data file does not exist (2).
                            {% endifequal %}

                            {% ifequal status 3 %}
                                Error: Property file does not exist (3).
                            {% endifequal %}

                            {% ifequal status 4 %}
                                Fatal: Perl is not installed. (4).
                            {% endifequal %}

                            {% ifequal status 5 %}
                                Fatal: GraphViz (neato/sfdp/dot) is not installed (5).
                            {% endifequal %}

                            {% ifequal status 6 %}
                                Error: Could not find afterglow instance (6).
                            {% endifequal %}

		</span></div></center>

                {% endif %}

            {% endif %}

            {% if submitError %}
                <script>$('#gallerySubmitForm').show();</script>
            {% endif %}




            <script type="text/javascript">
                var g = render('{{ STATIC_URL }}js/helios/lib/heliosDB.js',
                        '{{ STATIC_URL }}rendered/{{ requestID }}.json',
                        '#renderViewport');

            </script>
        </div>
    </div>
{% endblock %}
